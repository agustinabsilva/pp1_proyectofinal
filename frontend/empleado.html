<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empleado - AINABI</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="styleempleado.css" />
  <link rel="stylesheet" href="bienvenida.css" />
  <style>
    .custom-popup-class {
      border: 2px solid #e6e2c3;
      border-radius: 24px;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      position: fixed;
      top: 50% !important;
      left: calc(50% + 125px) !important; /* Ajustado de 150px a 125px para mover m√°s a la izquierda */
      transform: translate(-50%, -50%) !important;
      max-width: 500px !important;
      width: 90% !important;
    }
    .custom-title-class {
      color: #4d6a3a !important;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      margin-bottom: 0 !important;
      padding: 1em 1em 0.5em !important;
    }
    .custom-confirm-button {
      padding: 8px 32px !important;
      border-radius: 12px !important;
      font-family: 'Poppins', sans-serif !important;
    }
    .swal2-html-container {
      margin: 0 !important;
      padding: 0 10px 20px !important;
    }
    /* Ajustar el contenedor principal de SweetAlert2 */
    .swal2-container {
      align-items: center !important;
      padding: 0 !important;
    }
    /* Asegurar que el popup mantenga su tama√±o */
    .swal2-popup {
      margin: 0 !important;
    }
    
    @media (max-width: 768px) {
      .custom-popup-class {
        left: 50% !important; /* Reset en m√≥vil donde el sidebar no ocupa espacio */
      }
    }

    /* Estilos para el contenedor de ayuda */
    .help-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fdfbe8;
      border-radius: 20px;
      padding: 15px 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border: 2px solid #e6e2c3;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      z-index: 1000;
    }

    .help-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(77, 106, 58, 0.2);
      border-color: #4d6a3a;
    }

    .help-label {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #4d6a3a;
      font-weight: 600;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    .help-label img {
      width: 25px;
      height: auto;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .help-container:hover .help-label img {
      transform: rotate(10deg) scale(1.2);
    }

    /* Estilos para el modal del video */
    .video-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(77, 106, 58, 0.2);
      backdrop-filter: blur(5px);
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .video-modal.active {
      opacity: 1;
    }

    .video-modal .video-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      background: #fdfbe8;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 8px 32px rgba(77, 106, 58, 0.15);
      border: 2px solid #e6e2c3;
      width: 90%;
      max-width: 800px;
      height: 600px;
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .video-modal.active .video-container {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    .video-modal .help-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e6e2c3;
      width: 100%;
      text-align: center;
    }

    .video-modal .help-icon {
      width: 40px;
      height: 40px;
      min-width: 40px;
      background: #e6e2c3;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .video-modal .help-icon img {
      width: 25px;
      height: 25px;
      transition: transform 0.3s ease;
    }

    .video-modal .help-title {
      color: #4d6a3a;
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0;
      line-height: 1.3;
    }

    .video-wrapper {
      width: 100%;
      height: calc(100% - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(77, 106, 58, 0.1);
      overflow: hidden;
    }

    .video-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 16px;
      max-width: 560px;
      max-height: 315px;
    }

    .close-video {
      position: absolute;
      top: -15px;
      right: -15px;
      background: #4d6a3a;
      color: #fdfbe8;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 2px solid #fdfbe8;
      z-index: 2;
    }

    .close-video:hover {
      background: #779c5c;
      transform: scale(1.1) rotate(90deg);
    }

    .close-video i {
      font-size: 1rem;
      transition: transform 0.3s ease;
    }

    @media (max-width: 768px) {
      .video-modal .video-container {
        width: 95%;
        padding: 20px;
        height: 500px;
      }
    }

    @media (max-width: 576px) {
      .video-modal .video-container {
        padding: 15px;
        height: 400px;
      }
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
  
  <!-- Configuraci√≥n de Firebase -->
  <script src="env.js"></script>
  <script>
    // Verificar si ya existe una instancia de Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
</head>
<body>
  <!-- Bot√≥n hamburguesa para m√≥vil -->
  <div class="menu-toggle">
    <i class="fas fa-bars"></i>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-content">
      <div class="sidebar-top">
        <h2 class="logo mb-4">üåø AINABI</h2>
        <nav class="nav flex-column">
          <a href="./empleado.html" class="nav-link" id="nav-inicio">
            <i class="fas fa-home me-2"></i>Inicio
          </a>
          <a href="#" class="nav-link" id="nav-feedback">
            <i class="fas fa-sync-alt me-2"></i>Feedback 360¬∞
          </a>
          <a href="./profileempleado.html" class="nav-link" id="nav-perfil">
            <i class="fas fa-user me-2"></i>Mi Perfil
          </a>
        </nav>
      </div>

      <div class="sidebar-bottom">
        <a href="#" class="nav-link text-danger" id="btn-logout">
          <i class="fas fa-sign-out-alt me-2"></i>Salir
        </a>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main>
    <div id="inicio-section">
      <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
        <div class="card shadow-sm p-4" style="background: #fdfbe8; border-radius: 24px; border: 2px solid #e6e2c3; max-width: 400px; width: 100%;">
          <div class="bienvenida-carpincho" style="display: flex; justify-content: center;">
            <img src="./assets/profilephoto.png" 
                 alt="Carpincho AINABI" 
                 style="border-radius: 50%; 
                        object-fit: cover; 
                        background: #e6e2c3; 
                        margin-bottom: 10px;
                        transition: all 0.3s ease;
                        transform-origin: center;
                        cursor: pointer;"
                 class="carpincho-hover"
                 data-bs-toggle="tooltip" 
                 data-bs-placement="top" 
                 data-bs-custom-class="custom-tooltip"
                 title="Shh... no le digas a nadie pero sos mi preferido ü§´">
          </div>
          
          <h2 class="bienvenida-titulo text-center" style="color: #4d6a3a; font-weight: 700; letter-spacing: 2px; margin-bottom: 20px;">
            ¬°Hola, <span id="nombre-usuario">Usuario</span>!
          </h2>
          <p class="bienvenida-texto text-center" style="color: #4d6a3a;">
            <span class="bienvenida-emoji">üåø</span> Nos alegra tenerte como parte<br>
            de nuestro equipo.<span class="bienvenida-emoji">üåø</span><br><br>
            Desde ac√° podr√°s acceder, realizar<br>
            feedback y gestionar tu perfil.<br><br>
            <span class="bienvenida-resaltado" style="font-weight:600;">¬°El carpincho te acompa√±a en tu<br>
            desarrollo profesional!</span><br><br>
            Utiliz√° el men√∫ lateral para comenzar<br>
            a potenciar tu crecimiento.
          </p>
          <div class="bienvenida-brillo text-center">
            <span>‚ú®</span>
          </div>
          <style>
            .carpincho-hover:hover {
              transform: scale(1.1) rotate(5deg);
              box-shadow: 0 4px 15px rgba(183, 215, 194, 0.5);
            }
            
            .custom-tooltip {
              --bs-tooltip-bg: #4d6a3a;
              --bs-tooltip-color: #fff;
              font-family: 'Poppins', sans-serif;
              font-size: 0.9rem;
              padding: 8px;
              max-width: 200px;
            }
          </style>
        </div>
      </div>
    </div>

    <!-- Video container moved outside inicio-section -->
    <div class="help-container" id="help-trigger">
      <div class="help-label">
        ¬øNecesitas ayuda? El <img src="./assets/capyclipper.png" alt="Carpincho helper"> te da una patita
      </div>
    </div>

    <!-- Modal del video -->
    <div class="video-modal" id="video-modal">
      <div class="video-container">
        <div class="help-header">
          <div class="help-icon">
            <img src="./assets/capyclipper.png" alt="Carpincho helper">
          </div>
          <h3 class="help-title">¬°El carpincho te ayuda a aprender! üåø</h3>
        </div>
        <button class="close-video" aria-label="Cerrar video">
          <i class="fas fa-times"></i>
        </button>
        <div class="video-wrapper">
          <iframe width="560" height="315" src="https://www.youtube.com/embed/5paLp9ns7lc?si=oQLwV94JUfvsXJmL" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>
      </div>
    </div>

    <div id="autoevaluacion-section" style="display:none;">
      <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
        <div class="card shadow-sm p-4" style="background: #fdfbe8; border-radius: 24px; border: 2px solid #e6e2c3; max-width: 500px; width: 100%; margin: 20px;">
          <div class="text-center mb-3">
            <h2 style="color: #4d6a3a; font-weight: 700; letter-spacing: 0px; margin-bottom: 20px; white-space: nowrap; font-size: 1.6rem; overflow: hidden; text-overflow: ellipsis; padding: 0 10px;">‚ú®¬°Contanos tu experiencia!‚ú®</h2>
            <div style="background: #e6e2c3; border-radius: 50%; width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; box-shadow: 0 2px 8px #b7d7c2;">
              <img src="./assets/profilephoto.png" 
                   alt="Carpincho AINABI" 
                   style="width: 75px; 
                          height: 75px; 
                          border-radius: 50%; 
                          object-fit: cover;
                          transition: all 0.3s ease;
                          transform-origin: center;
                          cursor: pointer;"
                   class="carpincho-hover"
                   data-bs-toggle="tooltip" 
                   data-bs-placement="right" 
                   data-bs-custom-class="custom-tooltip"
                   title="¬°Gracias por compartir tu experiencia! üåø">
            </div>
          </div>
          <p class="text-center" style="color: #4d6a3a; margin-bottom: 18px;">
            ¬°Tu opini√≥n es muy valiosa para nosotros! <br>
            Contanos c√≥mo te sentiste este mes y ayudanos a seguir creciendo juntos.
          </p>
          <form style="width:100%;" id="form-autoevaluacion">
            <div class="mb-3 text-start">
              <label for="fecha-autoevaluacion" class="form-label" style="color: #4d6a3a;">
                Fecha de autoevaluaci√≥n <span style="color: #b88b66;">*</span>
              </label>
              <input type="date" 
                     class="form-control" 
                     id="fecha-autoevaluacion" 
                     readonly 
                     style="background-color: #f8f9fa; cursor: not-allowed;" 
                     required>
              <small class="form-text" style="color: #4d6a3a; display: block; margin-top: 4px;">
                üí° La autoevaluaci√≥n corresponde al d√≠a de hoy
              </small>
            </div>
            <div class="mb-3 text-start">
              <label for="desempeno" class="form-label" style="color: #4d6a3a;">
                ¬øC√≥mo evaluar√≠as tu desempe√±o? <span style="color: #b88b66;">*</span>
              </label>
              <select class="form-select" id="desempeno" required>
                <option value="">Selecciona una opci√≥n</option>
                <option value="Satisfactorio">Satisfactorio</option>
                <option value="Bueno">Bueno</option>
                <option value="Deficiente">Deficiente</option>
              </select>
            </div>
            <div class="mb-3 text-start">
              <label for="satisfaccion" class="form-label" style="color: #4d6a3a;">
                ¬øQu√© tan satisfecho te sent√≠s en tu trabajo? <span style="color: #b88b66;">*</span>
              </label>
              <select class="form-select" id="satisfaccion" required>
                <option value="">Selecciona una opci√≥n</option>
                <option value="Muy satisfecho">¬°Super contento! üòä Me encanta mi trabajo</option>
                <option value="Satisfecho">Me siento bien y c√≥modo üåü</option>
                <option value="Neutral">Normal, todo tranquilo üòå</option>
                <option value="Poco satisfecho">Podr√≠a estar mejor ü§î</option>
                <option value="Insatisfecho">No me siento muy c√≥modo üòï</option>
              </select>
              <small class="form-text" style="color: #4d6a3a; display: block; margin-top: 4px;">
                üí≠ Tu honestidad nos ayuda a mejorar juntos
              </small>
            </div>
            <div class="mb-3 text-start">
              <label for="comentario" class="form-label" style="color: #4d6a3a;">
                ¬øQuer√©s contarnos algo m√°s? <span style="color: #b88b66;">*</span>
              </label>
              <textarea class="form-control" 
                       id="comentario" 
                       rows="3" 
                       placeholder="Este es tu espacio para compartir tus experiencias, ideas o sugerencias. ¬°Nos encanta escucharte! üíö" 
                       required
                       minlength="10"></textarea>
              <small class="form-text" style="color: #4d6a3a; display: block; margin-top: 4px;">
                ‚úèÔ∏è M√≠nimo 10 caracteres
              </small>
            </div>
            <div class="text-center">
              <small class="form-text" style="color: #b88b66; display: block; margin-bottom: 10px;">
                * Todos los campos son obligatorios
              </small>
              <button type="submit" class="btn btn-light border btn-ainabi" style="border-radius: 12px; border: 2px solid #e6e2c3;">
                Enviar mi feedback
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="feedback-section" style="display:none;">
      <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
        <div class="card shadow-sm p-4" style="background: #fdfbe8; border-radius: 24px; border: 2px solid #e6e2c3; max-width: 400px; width: 100%;">
          <div class="text-center mb-3">
            <h5 class="card-title" style="color: #4d6a3a; font-weight: 700;">Feedback del Supervisor</h5>
            <div class="d-flex flex-column align-items-center mb-2">
              <img src="./assets/agus-img.png" class="rounded-circle mb-2" width="70" alt="Supervisor" style="border: 2px solid #b88b66;">
              <div style="color: #4d6a3a;">
                <strong>Mariana</strong><br>
                Desempe√±o: Bueno
              </div>
            </div>
            <p class="bg-light p-3 rounded" style="background: #fcfaee !important; color: #6c5c4c;">Buen rendimiento en los √∫ltimos proyectos</p>
            <button class="btn btn-light border btn-ainabi" style="border-radius: 12px; border: 2px solid #e6e2c3;">Enviar</button>
          </div>
        </div>
      </div>
    </div>

    <div id="perfil-section" style="display:none;">
      <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
        <div class="card shadow-sm p-4" style="background: #fdfbe8; border-radius: 24px; border: 2px solid #e6e2c3; max-width: 400px; width: 100%;">
          <div class="text-center mb-3">
            <h2 style="color: #4d6a3a; font-weight: 700; letter-spacing: 2px; margin-bottom: 20px;">üåøAINABIüåø</h2>
            <div style="display: flex; justify-content: center;">
              <div style="background: #e6e2c3; border-radius: 50%; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; box-shadow: 0 2px 8px #b7d7c2;">
                <img src="./assets/profilephoto.png" 
                     alt="Foto de perfil" 
                     style="width: 120px; 
                            height: 120px; 
                            border-radius: 50%; 
                            object-fit: cover;
                            transition: all 0.3s ease;
                            transform-origin: center;
                            cursor: pointer;"
                     class="profile-hover"
                     data-bs-toggle="tooltip" 
                     data-bs-placement="right" 
                     data-bs-custom-class="custom-tooltip"
                     title="¬°Hola! üåø">
              </div>
            </div>
            <h3 id="user-nombre" style="color: #4d6a3a; font-weight: 600; margin-bottom: 18px; margin-top: 10px;">Nombre Apellido</h3>
          </div>
          <div style="font-size: 1.1rem; color: #4d6a3a;">
            <div class="d-flex justify-content-between mb-2">
              <span style="font-weight: 500;">Rol:</span>
              <span id="user-rol" style="font-weight: 400;">Cargando...</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span style="font-weight: 500;">√Årea:</span>
              <span id="user-area" style="font-weight: 400;">Cargando...</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span style="font-weight: 500;">Jerarqu√≠a:</span>
              <span id="user-jerarquia" style="font-weight: 400;">Cargando...</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <span style="font-weight: 500;">Email:</span>
              <span id="user-email" style="font-weight: 400;">Cargando...</span>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <span style="font-weight: 500;">Activo:</span>
              <span>
                <span id="user-activo" style="background: #e6f5d0; color: #4d6a3a; border-radius: 16px; padding: 2px 16px; font-weight: 600; font-size: 1rem;">Activo</span>
              </span>
            </div>
          </div>
          <div class="text-center mt-3">
            <button id="btn-solicitar-cambio" class="btn btn-light border btn-ainabi" style="border-radius: 12px; border: 2px solid #e6e2c3;">Solicitar cambiar datos</button>
          </div>
          <style>
            .profile-hover:hover {
              transform: scale(1.1) rotate(5deg);
              box-shadow: 0 4px 15px rgba(183, 215, 194, 0.5);
            }
          </style>
        </div>
      </div>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // Funci√≥n para mostrar solo la secci√≥n seleccionada
    function mostrarSeccion(seccionId) {
      // Ocultar todas las secciones
      document.getElementById('inicio-section').style.display = 'none';
      document.getElementById('autoevaluacion-section').style.display = 'none';
      document.getElementById('feedback-section').style.display = 'none';
      document.getElementById('perfil-section').style.display = 'none';
      
      // Mostrar la secci√≥n seleccionada
      document.getElementById(seccionId).style.display = 'block';
      
      // Controlar la visibilidad del bot√≥n de ayuda
      const helpContainer = document.getElementById('help-trigger');
      if (seccionId === 'inicio-section') {
        helpContainer.style.display = 'block';
      } else {
        helpContainer.style.display = 'none';
      }
    }

    // Cambia la clase activa en la barra lateral
    function setActiveNav(navId) {
      document.getElementById('nav-inicio').classList.remove('nav-activa');
      document.getElementById('nav-feedback').classList.remove('nav-activa');
      document.getElementById('nav-perfil').classList.remove('nav-activa');
      document.getElementById(navId).classList.add('nav-activa');
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Por defecto, mostrar la secci√≥n de inicio
      mostrarSeccion('inicio-section');
      setActiveNav('nav-inicio');

      document.getElementById('nav-inicio').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('inicio-section');
        setActiveNav('nav-inicio');
      });

      document.getElementById('nav-feedback').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('autoevaluacion-section');
        setActiveNav('nav-feedback');
      });

      document.getElementById('nav-perfil').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('perfil-section');
        setActiveNav('nav-perfil');
      });
    });
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', async function() {
    // Espera a que Firebase est√© listo y el usuario est√© autenticado
    firebase.auth().onAuthStateChanged(async function(user) {
      if (user) {
        try {
          // Obtiene el documento del usuario desde la colecci√≥n 'users'
          const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
          if (userDoc.exists) {
            const data = userDoc.data();
            // Actualizar el nombre en la bienvenida
            const nombreUsuarioElement = document.getElementById("nombre-usuario");
            if (nombreUsuarioElement) {
              const nombreCompleto = data.nombre || "Usuario";
              const primerNombre = nombreCompleto.split(' ')[0];
              nombreUsuarioElement.textContent = primerNombre;
            }
            
            // Actualizar campos del perfil
            document.getElementById('user-nombre').textContent = data.nombre || "Sin nombre";
            document.getElementById('user-rol').textContent = data.role || "Sin rol";
            document.getElementById('user-area').textContent = data.area || "Sin √°rea";
            document.getElementById('user-jerarquia').textContent = data.jerarquia || "Sin jerarqu√≠a";
            document.getElementById('user-email').textContent = data.email || user.email || "Sin email";
            
            // Estado activo
            if (typeof data.activo !== "undefined") {
              document.getElementById('user-activo').textContent = data.activo ? "Activo" : "Inactivo";
              document.getElementById('user-activo').style.background = data.activo ? "#e6f5d0" : "#f5e6e6";
              document.getElementById('user-activo').style.color = data.activo ? "#4d6a3a" : "#a94442";
            } else {
              document.getElementById('user-activo').textContent = "Sin dato";
              document.getElementById('user-activo').style.background = "#f5e6e6";
              document.getElementById('user-activo').style.color = "#a94442";
            }
          }
        } catch (err) {
          console.error("Error al obtener datos del perfil:", err);
          // No redirigir si ya estamos en la p√°gina de login
          if (!window.location.pathname.includes('login.html')) {
            window.location.href = './login.html';
          }
        }
      } else {
        // Si no hay usuario logueado, redirigir al login
        // No redirigir si ya estamos en la p√°gina de login
        if (!window.location.pathname.includes('login.html')) {
          window.location.href = './login.html';
        }
      }
    });
  });
  // Guardar autoevaluaci√≥n con fecha y nombre
  const formAuto = document.getElementById('form-autoevaluacion');
  if (formAuto) {
    formAuto.addEventListener('submit', async function(e) {
      e.preventDefault();
      const fecha = document.getElementById('fecha-autoevaluacion').value;
      const desempeno = document.getElementById('desempeno').value;
      const satisfaccion = document.getElementById('satisfaccion').value;
      const comentario = document.getElementById('comentario').value;
      try {
        const user = firebase.auth().currentUser;
        if (user) {
          // Obtener el nombre del usuario desde la colecci√≥n users
          const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
          let nombre = "";
          if (userDoc.exists) {
            nombre = userDoc.data().nombre || "";
          }
          
          // --- NUEVO BLOQUE: Verificar si ya existe autoevaluaci√≥n este mes ---
          // Extraer a√±o y mes de la fecha seleccionada
          const [anioSeleccionado, mesSeleccionado] = fecha.split('-');
          // Buscar autoevaluaciones de este usuario en el mes y a√±o seleccionados
          const querySnapshot = await firebase.firestore()
            .collection('autoevaluaciones')
            .where('uid', '==', user.uid)
            .get();
          
          let yaExiste = false;
          querySnapshot.forEach(doc => {
            const data = doc.data();
            if (data.fecha) {
              const [anio, mes] = data.fecha.split('-');
              if (anio === anioSeleccionado && mes === mesSeleccionado) {
                yaExiste = true;
              }
            }
          });
          
          if (yaExiste) {
            Swal.fire({
              title: 'üåø¬°Ya realizaste tu feedback este mes!üåø',
              html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                      <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <img src="./assets/profilephoto.png" 
                             alt="Carpincho AINABI" 
                             style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid #e6e2c3;">
                      </div>
                      <p style="margin: 15px auto; font-size: 1.1rem; max-width: 300px; line-height: 1.5;">
                        ¬°Gracias por tu compromiso! <br>Te esperamos el pr√≥ximo mes para seguir creciendo juntos
                      </p>
                    </div>`,
              showConfirmButton: true,
              confirmButtonText: 'Entendido',
              confirmButtonColor: '#4d6a3a',
              background: '#fdfbe8',
              customClass: {
                popup: 'custom-popup-class',
                title: 'custom-title-class',
                confirmButton: 'custom-confirm-button'
              }
            }).then((result) => {
              if (result.isConfirmed) {
                // Limpiar el formulario
                formAuto.reset();
                // Actualizar la fecha al d√≠a actual
                const fechaInput = document.getElementById('fecha-autoevaluacion');
                if (fechaInput) {
                  const hoy = new Date();
                  const formatearFecha = (fecha) => {
                    const year = fecha.getFullYear();
                    const month = String(fecha.getMonth() + 1).padStart(2, '0');
                    const day = String(fecha.getDate()).padStart(2, '0');
                    return `${year}-${month}-${day}`;
                  };
                  fechaInput.value = formatearFecha(hoy);
                }
                // Redireccionar al inicio
                mostrarSeccion('inicio-section');
                setActiveNav('nav-inicio');
              }
            });
            return;
          }
          // --- FIN NUEVO BLOQUE ---
          
          await firebase.firestore().collection('autoevaluaciones').add({
            uid: user.uid,
            nombre: nombre,
            fecha: fecha,
            desempeno: desempeno,
            satisfaccion: satisfaccion,
            comentario: comentario,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

          Swal.fire({
            title: 'üåø ¬°Gracias por tu feedback! üåø',
            html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                      <div style="position: relative; display: inline-block;">
                        <img src="./assets/capiok.png" 
                             alt="Carpincho AINABI" 
                             style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                             class="profile-hover">
                        <div style="position: absolute; bottom: 0; right: 0; background: #4d6a3a; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;">
                          <span style="color: #fff; font-size: 14px;">‚úì</span>
                        </div>
                      </div>
                    </div>
                    <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                      <p style="color: #4d6a3a; font-weight: 600; margin-bottom: 10px;">
                        ¬°Tu feedback fue enviado con √©xito!
                      </p>
                      <p style="color: #4d6a3a; font-size: 0.95rem; margin: 0;">
                        Gracias por ayudarnos a seguir mejorando
                      </p>
                    </div>
                  </div>`,
            showConfirmButton: true,
            confirmButtonText: 'Entendido',
            confirmButtonColor: '#4d6a3a',
            background: '#fdfbe8',
            customClass: {
              popup: 'custom-popup-class',
              title: 'custom-title-class',
              confirmButton: 'custom-confirm-button'
            }
          }).then((result) => {
            if (result.isConfirmed) {
              // Limpiar el formulario
              formAuto.reset();
              // Actualizar la fecha al d√≠a actual
              const fechaInput = document.getElementById('fecha-autoevaluacion');
              if (fechaInput) {
                const hoy = new Date();
                const formatearFecha = (fecha) => {
                  const year = fecha.getFullYear();
                  const month = String(fecha.getMonth() + 1).padStart(2, '0');
                  const day = String(fecha.getDate()).padStart(2, '0');
                  return `${year}-${month}-${day}`;
                };
                fechaInput.value = formatearFecha(hoy);
              }
              // Redireccionar al inicio
              mostrarSeccion('inicio-section');
              setActiveNav('nav-inicio');
            }
          });
        } else {
          alert('Debes estar logueado para guardar la autoevaluaci√≥n.');
        }
      } catch (err) {
        alert('Error al guardar la autoevaluaci√≥n: ' + err.message);
      }
    });
  }
  </script>

<!-- Modal para solicitar cambio de datos -->
<style>
  .modal-centered {
    position: fixed !important;
    top: 50% !important;
    left: calc(50% + 125px) !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
  }
  
  .modal-centered .modal-content {
    margin: 0 auto !important;
    max-width: 600px !important;
    width: 100% !important;
    min-height: 600px !important;
    display: flex !important;
    flex-direction: column !important;
    padding: 20px !important;
  }

  .modal-centered .modal-body {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    padding: 0 !important;
  }

  .modal-centered .modal-body > div {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
  }

  .form-container {
    background: rgba(230, 226, 195, 0.3);
    border-radius: 16px;
    padding: 35px 50px;
    margin: 20px auto;
    width: 100% !important;
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
  }

  .modal-centered .btn-close {
    position: absolute !important;
    right: 20px !important;
    top: 20px !important;
    opacity: 1 !important;
    color: #4d6a3a !important;
    background: none !important;
    border: none !important;
    font-size: 1.5rem !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    padding: 0 !important;
    width: 30px !important;
    height: 30px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .modal-centered .btn-close:hover {
    color: #b88b66 !important;
    transform: scale(1.1) !important;
  }

  .modal-centered .btn-close:focus {
    box-shadow: none !important;
    outline: none !important;
  }

  @media (max-width: 768px) {
    .modal-centered {
      left: 50% !important;
      top: 0 !important;
      transform: translate(-50%, 0) !important;
      width: 100% !important;
      height: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
    }

    .modal-centered .modal-content {
      width: 100% !important;
      height: 100% !important;
      max-width: none !important;
      min-height: 100vh !important;
      margin: 0 !important;
      padding: 15px !important;
      border: none !important;
      border-radius: 0 !important;
    }

    .modal-centered .modal-body {
      padding: 10px !important;
      margin-top: 20px !important;
    }

    .form-container {
      padding: 20px !important;
      margin: 10px auto !important;
      width: 100% !important;
    }

    .modal-centered .btn-close {
      right: 15px !important;
      top: 15px !important;
    }

    .modal-centered h5.modal-title {
      font-size: 1.3rem !important;
      margin: 15px 0 20px !important;
    }

    .modal-centered input.form-control {
      font-size: 1rem !important;
      padding: 10px 15px !important;
    }

    .modal-centered label.form-label {
      font-size: 1rem !important;
    }

    .modal-centered button[type="submit"] {
      width: 100% !important;
      margin-top: 10px !important;
      padding: 12px !important;
    }
  }

  @media (max-width: 480px) {
    .modal-centered .modal-content {
      padding: 10px !important;
    }

    .form-container {
      padding: 15px !important;
    }

    .modal-centered h5.modal-title {
      font-size: 1.2rem !important;
    }
  }
</style>

<div class="modal fade" id="modalCambioDatos" tabindex="-1" aria-labelledby="modalCambioDatosLabel" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered modal-centered">
    <div class="modal-content" style="background: #fdfbe8; border: 2px solid #e6e2c3; border-radius: 24px;">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar">
        <i class="fas fa-times"></i>
      </button>
      <div class="modal-body">
        <div style="text-align: center;">
          <h5 class="modal-title" id="modalCambioDatosLabel" style="color: #4d6a3a; font-weight: 700; font-family: 'Poppins', sans-serif; margin: 20px 0 30px; font-size: 1.5rem;">
            Solicitud de cambio de datos 
          </h5>
          <div style="display: flex; justify-content: center; margin-bottom: 30px;">
            <div style="position: relative; display: inline-block;">
              <img src="./assets/profilephoto.png" 
                   alt="Carpincho AINABI" 
                   style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                   class="profile-hover">
            </div>
          </div>
          <p style="color: #4d6a3a; margin-bottom: 30px; font-size: 1.2rem;">
            Completa los datos que deseas actualizar 
          </p>
          <form id="form-cambio-datos" style="flex: 1; display: flex; flex-direction: column;">
            <div class="form-container">
              <div class="mb-5">
                <label for="nuevo-nombre" class="form-label" style="color: #4d6a3a; font-weight: 500; text-align: left; display: block; margin-bottom: 10px; font-size: 1.1rem;">
                  Nuevo nombre <span style="color: #b88b66;">*</span>
                </label>
                <input type="text" 
                       class="form-control" 
                       id="nuevo-nombre" 
                       required
                       style="border: 2px solid #e6e2c3; 
                              border-radius: 12px; 
                              background: #fff; 
                              padding: 12px 20px;
                              font-size: 1.1rem;">
              </div>
              <div class="mb-5">
                <label for="nuevo-email" class="form-label" style="color: #4d6a3a; font-weight: 500; text-align: left; display: block; margin-bottom: 10px; font-size: 1.1rem;">
                  Nuevo email <span style="color: #b88b66;">*</span>
                </label>
                <input type="email" 
                       class="form-control" 
                       id="nuevo-email" 
                       required
                       style="border: 2px solid #e6e2c3; 
                              border-radius: 12px; 
                              background: #fff; 
                              padding: 12px 20px;
                              font-size: 1.1rem;"
                       oninput="validarEmail(this)">
                <div id="email-error" style="color: #b88b66; font-size: 0.9rem; margin-top: 8px; display: none;">
                  Por favor, ingresa un email v√°lido
                </div>
              </div>
            </div>
            <div style="margin-top: auto; padding-bottom: 10px;">
              <small class="form-text" style="color: #b88b66; display: block; margin-bottom: 20px; font-size: 1rem;">
                * Todos los campos son obligatorios
              </small>
              <button type="submit" 
                      class="btn btn-light border btn-ainabi" 
                      style="border-radius: 12px; 
                             border: 2px solid #e6e2c3; 
                             padding: 12px 50px; 
                             background: #4d6a3a; 
                             color: #fff; 
                             font-family: 'Poppins', sans-serif;
                             font-size: 1.1rem;">
                Enviar solicitud
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Inicializar el modal con las opciones correctas
document.addEventListener('DOMContentLoaded', function() {
  const modalCambioDatos = document.getElementById('modalCambioDatos');
  if (modalCambioDatos) {
    const modal = new bootstrap.Modal(modalCambioDatos, {
      backdrop: true,
      keyboard: true
    });
  }
});

// Mostrar el modal al hacer clic en el bot√≥n
document.addEventListener('DOMContentLoaded', function() {
  const btnCambio = document.getElementById('btn-solicitar-cambio');
  if (btnCambio) {
    btnCambio.addEventListener('click', function() {
      const modal = new bootstrap.Modal(document.getElementById('modalCambioDatos'));
      modal.show();
    });
  }

  // Manejar el env√≠o del formulario de cambio de datos
  const formCambio = document.getElementById('form-cambio-datos');
  if (formCambio) {
    formCambio.addEventListener('submit', async function(e) {
      e.preventDefault();
      const nuevoNombre = document.getElementById('nuevo-nombre').value;
      const nuevoEmail = document.getElementById('nuevo-email').value;

      try {
        const user = firebase.auth().currentUser;
        if (user) {
          // Verificar si el email ya existe en la base de datos
          const emailQuery = await firebase.firestore()
            .collection('users')
            .where('email', '==', nuevoEmail)
            .get();

          if (!emailQuery.empty) {
            const emailInput = document.getElementById('nuevo-email');
            const errorDiv = document.getElementById('email-error');
            emailInput.style.borderColor = '#b88b66';
            errorDiv.textContent = 'Este email ya est√° registrado';
            errorDiv.style.display = 'block';
            return;
          }

          // Obtener datos actuales del usuario
          const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
          let nombreActual = '';
          let emailActual = '';
          if (userDoc.exists) {
            const data = userDoc.data();
            nombreActual = data.nombre || '';
            emailActual = data.email || user.email || '';
          }

          // Si el email es el mismo que el actual
          if (nuevoEmail === emailActual) {
            const emailInput = document.getElementById('nuevo-email');
            const errorDiv = document.getElementById('email-error');
            emailInput.style.borderColor = '#b88b66';
            errorDiv.textContent = 'El nuevo email debe ser diferente al actual';
            errorDiv.style.display = 'block';
            return;
          }

          await firebase.firestore().collection('solicitudes_cambio_datos').add({
            uid: user.uid,
            nombre_actual: nombreActual,
            email_actual: emailActual,
            nombre_nuevo: nuevoNombre,
            email_nuevo: nuevoEmail,
            estado: "pendiente",
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

          // Cerrar el modal
          bootstrap.Modal.getInstance(document.getElementById('modalCambioDatos')).hide();

          // Mostrar mensaje de √©xito
          Swal.fire({
            title: 'üåø ¬°Solicitud enviada! üåø',
            html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                      <div style="position: relative; display: inline-block;">
                        <img src="./assets/profilephoto.png" 
                             alt="Carpincho AINABI" 
                             style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                             class="profile-hover">
                        <div style="position: absolute; bottom: 0; right: 0; background: #4d6a3a; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;">
                          <span style="color: #fff; font-size: 14px;">‚úì</span>
                        </div>
                      </div>
                    </div>
                    <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                      <p style="color: #4d6a3a; font-weight: 600; margin-bottom: 10px;">
                        Tu solicitud fue enviada al administrador
                      </p>
                      <p style="color: #4d6a3a; font-size: 0.95rem; margin: 0;">
                        De ser aceptada, te notificaremos por email
                      </p>
                    </div>
                  </div>`,
            showConfirmButton: true,
            confirmButtonText: 'Entendido',
            confirmButtonColor: '#4d6a3a',
            background: '#fdfbe8',
            customClass: {
              popup: 'custom-popup-class',
              title: 'custom-title-class',
              confirmButton: 'custom-confirm-button'
            }
          });
          formCambio.reset();
        } else {
          Swal.fire({
            title: 'üåø Error üåø',
            html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                      <div style="position: relative; display: inline-block;">
                        <img src="./assets/profilephoto.png" 
                             alt="Carpincho AINABI" 
                             style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                             class="profile-hover">
                      </div>
                    </div>
                    <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                      <p style="color: #4d6a3a; font-weight: 600; margin: 0;">
                        Debes estar logueado para enviar la solicitud
                      </p>
                    </div>
                  </div>`,
            showCloseButton: true,
            allowOutsideClick: true,
            allowEscapeKey: true,
            confirmButtonColor: '#4d6a3a',
            background: '#fdfbe8',
            customClass: {
              popup: 'custom-popup-class',
              title: 'custom-title-class',
              confirmButton: 'custom-confirm-button'
            }
          });
        }
      } catch (err) {
        Swal.fire({
          title: 'üåø Error üåø',
          html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                  <div style="display: flex; justify-content: center; margin: 20px 0;">
                    <div style="position: relative; display: inline-block;">
                      <img src="./assets/profilephoto.png" 
                           alt="Carpincho AINABI" 
                           style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                           class="profile-hover">
                    </div>
                  </div>
                  <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                    <p style="color: #4d6a3a; font-weight: 600; margin: 0;">
                      No se pudo enviar la solicitud: ${err.message}
                    </p>
                  </div>
                </div>`,
          showCloseButton: true,
          allowOutsideClick: true,
          allowEscapeKey: true,
          confirmButtonColor: '#4d6a3a',
          background: '#fdfbe8',
          customClass: {
            popup: 'custom-popup-class',
            title: 'custom-title-class',
            confirmButton: 'custom-confirm-button',
            closeButton: 'custom-close-button'
          }
        });
      }
    });
  }
});

function validarEmail(input) {
  const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
  const errorDiv = document.getElementById('email-error');
  const submitButton = document.querySelector('#form-cambio-datos button[type="submit"]');
  
  if (!emailRegex.test(input.value)) {
    input.style.borderColor = '#b88b66';
    errorDiv.style.display = 'block';
    submitButton.disabled = true;
  } else {
    input.style.borderColor = '#e6e2c3';
    errorDiv.style.display = 'none';
    submitButton.disabled = false;
  }
}
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      
      menuToggle.addEventListener('click', function() {
        sidebar.classList.toggle('active');
        menuToggle.classList.toggle('active');
      });

      // Cerrar men√∫ al hacer clic en un enlace (en m√≥vil)
      document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.addEventListener('click', function() {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove('active');
            menuToggle.classList.remove('active');
          }
        });
      });
    });
  </script>
  <script>
  // Agregar el manejador para el bot√≥n de logout
  document.addEventListener('DOMContentLoaded', function() {
    const btnLogout = document.getElementById('btn-logout');
    if (btnLogout) {
      btnLogout.addEventListener('click', async function(e) {
        e.preventDefault();
        
        // Mostrar popup de confirmaci√≥n
        Swal.fire({
          title: 'üåø ¬øDeseas cerrar sesi√≥n? üåø',
          html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                  <div style="display: flex; justify-content: center; margin: 20px 0;">
                    <div style="position: relative; display: inline-block;">
                      <img src="./assets/profilephoto.png" 
                           alt="Carpincho AINABI" 
                           style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                           class="profile-hover">
                    </div>
                  </div>
                  <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                    <p style="color: #4d6a3a; font-weight: 600; margin: 0;">
                      Est√°s a punto de cerrar sesi√≥n
                    </p>
                  </div>
                </div>`,
          showCancelButton: true,
          showCloseButton: true,
          allowOutsideClick: true,
          allowEscapeKey: true,
          confirmButtonText: 'S√≠, salir',
          cancelButtonText: 'No, quedarme',
          confirmButtonColor: '#4d6a3a',
          cancelButtonColor: '#b88b66',
          background: '#fdfbe8',
          customClass: {
            popup: 'custom-popup-class',
            title: 'custom-title-class',
            confirmButton: 'custom-confirm-button',
            cancelButton: 'custom-cancel-button',
            closeButton: 'custom-close-button'
          }
        }).then(async (result) => {
          if (result.isConfirmed) {
            try {
              await firebase.auth().signOut();
              // Limpiar cualquier dato de sesi√≥n almacenado
              sessionStorage.clear();
              localStorage.clear();
              // Redirigir al login
              window.location.href = './login.html';
            } catch (error) {
              console.error('Error al cerrar sesi√≥n:', error);
              Swal.fire({
                title: 'üåø Error üåø',
                html: `<div style="color: #4d6a3a; font-family: 'Poppins', sans-serif; text-align: center;">
                        <div style="display: flex; justify-content: center; margin: 20px 0;">
                          <div style="position: relative; display: inline-block;">
                            <img src="./assets/profilephoto.png" 
                                 alt="Carpincho AINABI" 
                                 style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; background: #e6e2c3; padding: 10px;"
                                 class="profile-hover">
                          </div>
                        </div>
                        <div style="background: rgba(230, 226, 195, 0.3); border-radius: 16px; padding: 20px; margin: 15px auto; max-width: 300px;">
                          <p style="color: #4d6a3a; font-weight: 600; margin: 0;">
                            No se pudo cerrar la sesi√≥n. Por favor, intenta nuevamente.
                          </p>
                        </div>
                      </div>`,
                showCloseButton: true,
                allowOutsideClick: true,
                allowEscapeKey: true,
                confirmButtonColor: '#4d6a3a',
                background: '#fdfbe8',
                customClass: {
                  popup: 'custom-popup-class',
                  title: 'custom-title-class',
                  confirmButton: 'custom-confirm-button',
                  closeButton: 'custom-close-button'
                }
              });
            }
          }
        });
      });
    }
  });
  </script>
  <script>
    // Inicializar todos los tooltips
    document.addEventListener('DOMContentLoaded', function() {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Configurar la fecha actual
      const fechaInput = document.getElementById('fecha-autoevaluacion');
      if (fechaInput) {
        const hoy = new Date();
        const formatearFecha = (fecha) => {
          const year = fecha.getFullYear();
          const month = String(fecha.getMonth() + 1).padStart(2, '0');
          const day = String(fecha.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
        };
        fechaInput.value = formatearFecha(hoy);
      }
    });
  </script>
  <script>
    // Funcionalidad para el modal del video
    document.addEventListener('DOMContentLoaded', function() {
      const helpTrigger = document.getElementById('help-trigger');
      const videoModal = document.getElementById('video-modal');
      const closeVideo = document.querySelector('.close-video');

      helpTrigger.addEventListener('click', function() {
        videoModal.style.display = 'block';
        // Forzar reflow
        void videoModal.offsetWidth;
        videoModal.classList.add('active');
      });

      function closeVideoModal() {
        videoModal.classList.remove('active');
        setTimeout(() => {
          videoModal.style.display = 'none';
        }, 300);
      }

      closeVideo.addEventListener('click', closeVideoModal);

      videoModal.addEventListener('click', function(e) {
        if (e.target === videoModal) {
          closeVideoModal();
        }
      });

      // Cerrar con la tecla Escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && videoModal.style.display === 'block') {
          closeVideoModal();
        }
      });
    });
  </script>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>