<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Analista - AINABI</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&display=swap" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="styleempleado.css" />
  <link rel="stylesheet" href="bienvenida.css" />
  <link rel="stylesheet" href="styleprofile.css" />
  <style>
    #tabla-container {
      overflow-x: auto; /* Permite el scroll horizontal si la tabla es muy ancha */
      max-width: 100%;  /* Asegura que el contenedor no se desborde de su padre (la card) */
    }
    #tabla-container table {
      font-size: 0.875rem; /* Reduce un poco el tamaño de la fuente de la tabla */
      width: 100%;       /* Hace que la tabla ocupe el ancho disponible en su contenedor (que ahora tiene scroll) */
    }
    #tabla-container th,
    #tabla-container td {
      padding: 0.5rem 0.75rem; /* Ajusta el padding de las celdas para que sean un poco más compactas */
      white-space: nowrap;   /* Evita que el texto largo en las celdas se divida en múltiples líneas,
                                 lo cual funciona bien con el scroll horizontal del contenedor.
                                 Si prefieres que el texto se divida, puedes comentar o quitar esta línea. */
    }

    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .stat-card {
      background: rgba(230, 226, 195, 0.3);
      padding: 1.5rem;
      border-radius: 16px;
      text-align: center;
      border: 1px solid #e6e2c3;
      transition: all 0.3s ease;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #4d6a3a;
      margin-bottom: 0.75rem;
    }

    .stat-label {
      color: #4d6a3a;
      font-size: 1rem;
      font-weight: 500;
      line-height: 1.3;
    }

    .btn-ainabi {
      background-color: #4d6a3a;
      color: #fff;
      border-radius: 12px;
      border: none;
      padding: 8px 16px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-ainabi:hover {
      background-color: #3a5129;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .custom-popup-class {
      border: 2px solid #e6e2c3;
      border-radius: 24px;
      font-family: 'Poppins', sans-serif;
      text-align: center;
      position: fixed;
      top: 50% !important;
      left: calc(50% + 125px) !important; /* Ajustado para mover más a la izquierda */
      transform: translate(-50%, -50%) !important;
      max-width: 500px !important;
      width: 90% !important;
    }
    .custom-title-class {
      color: #4d6a3a !important;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      margin-bottom: 0 !important;
      padding: 1em 1em 0.5em !important;
    }
    .custom-confirm-button {
      padding: 8px 32px !important;
      border-radius: 12px !important;
      font-family: 'Poppins', sans-serif !important;
    }
    .swal2-html-container {
      margin: 0 !important;
      padding: 0 10px 20px !important;
    }
    /* Ajustar el contenedor principal de SweetAlert2 */
    .swal2-container {
      align-items: center !important;
      padding: 0 !important;
    }
    /* Asegurar que el popup mantenga su tamaño */
    .swal2-popup {
      margin: 0 !important;
    }
    
    @media (max-width: 768px) {
      .custom-popup-class {
        left: 50% !important; /* Reset en móvil donde el sidebar no ocupa espacio */
      }
    }
    
    .profile-hover:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 4px 15px rgba(183, 215, 194, 0.5);
    }

    /* Estilos para la sección de entrenamiento IA */
    .section-card {
      background-color: rgba(244, 247, 235, 0.7);
      border-radius: 20px;
      border: 1px solid #e6e2c3;
      padding: 25px;
      margin-bottom: 20px;
    }

    .section-title {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 1.3rem;
      color: #8b7e55;
      margin-bottom: 1.2rem;
    }

    .header-title {
      font-family: 'Caveat', cursive;
      font-weight: 600;
      font-size: 2.8rem;
      color: #8b7e55;
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .header-subtitle {
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      color: #4d6a3a;
      text-align: center;
      margin-bottom: 2rem;
    }

    .form-check-input {
      width: 20px;
      height: 20px;
      margin-top: 0.2rem;
      border: 2px solid #e6e2c3;
    }

    .file-upload-btn {
      background-color: #f4f7eb;
      border: 1px solid #e6e2c3;
      border-radius: 15px;
      padding: 10px 20px;
      color: #4d6a3a;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 250px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-upload-btn:hover {
      background-color: #e6e2c3;
    }

    .file-name-display {
      background-color: #f4f7eb;
      border: 1px solid #e6e2c3;
      border-radius: 15px;
      padding: 10px 20px;
      color: #4d6a3a;
      font-weight: 500;
      margin-top: 10px;
      display: inline-block;
    }

    .table-container {
      margin-top: 15px;
      margin-bottom: 15px;
    }

    .preview-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border: 1px solid #e6e2c3;
      border-radius: 10px;
      overflow: hidden;
    }

    .preview-table th {
      background-color: #f4f7eb;
      color: #4d6a3a;
      font-weight: 600;
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid #e6e2c3;
    }

    .preview-table td {
      padding: 8px 12px;
      border-bottom: 1px solid #e6e2c3;
      color: #4d6a3a;
    }

    .warning-text {
      color: #b88b66;
      display: flex;
      align-items: center;
      margin-top: 10px;
    }

    .warning-text i {
      margin-right: 8px;
    }

    .dropdown-select {
      background-color: #f4f7eb;
      border: 1px solid #e6e2c3;
      border-radius: 15px;
      padding: 10px 20px;
      color: #4d6a3a;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%234d6a3a' viewBox='0 0 16 16'><path d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/></svg>");
      background-repeat: no-repeat;
      background-position: calc(100% - 15px) center;
      padding-right: 35px;
    }

    .config-item {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .config-icon {
      width: 24px;
      height: 24px;
      margin-right: 10px;
      color: #4d6a3a;
    }

    .btn-train {
      background-color: #e6e2c3;
      border: none;
      border-radius: 20px;
      color: #4d6a3a;
      font-weight: 600;
      padding: 12px 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      float: right;
    }

    .btn-train:hover {
      background-color: #d9d5b8;
      transform: translateY(-2px);
    }

    .history-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 15px;
    }

    .history-table th,
    .history-table td {
      padding: 10px 15px;
      text-align: left;
      color: #4d6a3a;
    }

    .history-table th {
      font-weight: 600;
      border-bottom: 1px solid #e6e2c3;
    }

    .btn-use-model {
      background-color: #e6e2c3;
      border: none;
      border-radius: 15px;
      color: #4d6a3a;
      font-weight: 500;
      padding: 5px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-use-model:hover {
      background-color: #d9d5b8;
    }

    .hidden-file-input {
      display: none;
    }

    .main-container {
      background-color: #fdfbe8;
      border-radius: 24px;
      padding: 30px;
      border: 2px solid #e6e2c3;
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
    }
  </style>
  <!-- Firebase y lógica de app -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-firestore-compat.js"></script>
  <!-- Fin Firebase -->
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <aside class="sidebar p-4 d-flex flex-column justify-content-between">
      <div>
        <h2 class="logo mb-4">🌿 AINABI</h2>
        <nav class="nav flex-column">
          <a href="#" class="nav-link nav-activa" id="nav-entrenamiento-ia">
            <i class="fas fa-robot me-2"></i>Entrenamiento IA
          </a>
          <a href="#" class="nav-link" id="nav-predecir-rendimiento">
            <i class="fas fa-chart-line me-2"></i>Predecir Rendimiento
          </a>
          <a href="#" class="nav-link" id="nav-deteccion-rotacion">
            <i class="fas fa-user-slash me-2"></i>Detección de Rotación
          </a>
          <a href="#" class="nav-link" id="nav-perfil">
            <i class="fas fa-user me-2"></i>Mi Perfil
          </a>
        </nav>
      </div>
      <div class="mt-4">
        <a href="#" class="nav-link text-danger" id="btn-logout">
          <i class="fas fa-sign-out-alt me-2"></i>Salir
        </a>
      </div>
    </aside>

    <!-- Sección principal -->
    <main class="flex-grow-1 p-4">
      <div id="entrenamiento-ia-section">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
          <div class="main-container" style="max-width: 1400px; width: 95%; background-color: #faf6e9; border-radius: 20px; border: 1px solid #e6e2c3; padding: 30px;">
            <!-- Encabezado -->
            <div class="text-center mb-4">
              <h1 style="font-family: 'Caveat', cursive; font-weight: 600; font-size: 2.8rem; color: #8b7e55; margin-bottom: 10px;">✨ Entrenamiento de Modelos IA ✨</h1>
              <p style="font-family: 'Poppins', sans-serif; color: #4d6a3a; font-size: 1.1rem; margin-bottom: 25px;">
                Entrená un modelo de inteligencia artificial para predecir el rendimiento de los empleados.
              </p>
            </div>
            
            <!-- Contenedor principal -->
            <div style="background-color: #fff; border-radius: 15px; border: 1px solid #e6e2c3; padding: 25px; margin-bottom: 20px; overflow-x: visible;">
              <!-- Sección de carga de dataset -->
              <h3 style="color: #6b5b3d; font-size: 1.3rem; margin-bottom: 20px;">Cargar Dataset de Entrenamiento</h3>
              
              <div class="mb-4">
                <input type="file" id="csvFile" accept=".csv" class="hidden-file-input">
                <label for="csvFile" style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 12px 20px; color: #6b5b3d; display: block; cursor: pointer; text-align: center; width: 100%;">
                  <i class="fas fa-check-circle me-2"></i> Seleccionar archivo
                </label>
              </div>
              
              <!-- Formato esperado del dataset -->
              <div style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 12px 15px; margin-bottom: 25px;">
                <p style="color: #6b5b3d; font-size: 0.9rem; margin-bottom: 8px; font-weight: 500;">
                  <i class="fas fa-info-circle me-2"></i> Formato esperado del dataset:
                </p>
                <div style="overflow-x: auto; max-width: 100%;">
                  <table style="width: 100%; min-width: 900px; table-layout: fixed; border-collapse: separate; border-spacing: 0; border: 1px solid #e6e2c3; border-radius: 6px; overflow: hidden; background-color: #fff;">
                    <thead>
                      <tr style="background-color: #f0e6c7;">
                        <th style="width: 9%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">nombre</th>
                        <th style="width: 7%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">area</th>
                        <th style="width: 8%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">jerarquia</th>
                        <th style="width: 7%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">puntaje</th>
                        <th style="width: 12%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">cantidad_proyectos</th>
                        <th style="width: 9%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">desempenio</th>
                        <th style="width: 12%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">personas_equipo</th>
                        <th style="width: 10%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">horas_extra</th>
                        <th style="width: 14%; padding: 10px 4px; text-align: center; color: #6b5b3d; border-right: 1px solid #e6e2c3; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">asistencia_puntualidad</th>
                        <th style="width: 12%; padding: 10px 4px; text-align: center; color: #6b5b3d; font-size: 0.8rem; font-weight: 600; white-space: nowrap;">desempenio_futuro</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">texto</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">texto</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">texto</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">número</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">número</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">texto</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">número</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">número</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem; border-right: 1px solid #e6e2c3;">número</td>
                        <td style="padding: 8px; text-align: center; color: #8b7e55; font-size: 0.8rem;">número</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <p style="color: #8b7e55; font-size: 0.8rem; margin-top: 8px; margin-bottom: 0;">
                  El archivo CSV debe incluir todas estas columnas para que el modelo funcione correctamente.
                </p>
              </div>
              
              <!-- Sección de configuración -->
              <h3 style="color: #6b5b3d; font-size: 1.3rem; margin-bottom: 20px; margin-top: 30px;">Configurar el Modelo</h3>
              
              <!-- Configuración del modelo -->
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <label style="color: #6b5b3d; font-weight: 500;">Variable objetivo:</label>
                  <span style="color: #6b5b3d; font-weight: 400;">desempenio_futuro</span>
                </div>
                
                <div style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                  <p style="color: #6b5b3d; font-weight: 500; margin-bottom: 10px;">Variables a utilizar:</p>
                  <div class="row">
                    <div class="col-3">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varNombre" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varNombre" style="color: #6b5b3d;">
                          nombre
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varArea" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varArea" style="color: #6b5b3d;">
                          area
                        </label>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varJerarquia" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varJerarquia" style="color: #6b5b3d;">
                          jerarquia
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varPuntaje" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varPuntaje" style="color: #6b5b3d;">
                          puntaje
                        </label>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varProyectos" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varProyectos" style="color: #6b5b3d;">
                          cantidad_proyectos
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varDesempenio" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varDesempenio" style="color: #6b5b3d;">
                          desempenio
                        </label>
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varPersonasEquipo" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varPersonasEquipo" style="color: #6b5b3d;">
                          personas_equipo
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varHorasExtra" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varHorasExtra" style="color: #6b5b3d;">
                          horas_extra
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-3">
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="varAsistencia" checked style="border-color: #b88b66;">
                        <label class="form-check-label" for="varAsistencia" style="color: #6b5b3d;">
                          asistencia_puntualidad
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Botón de entrenamiento -->
              <button id="btnTrainModel" style="background-color: #f0e6c7; border: none; border-radius: 10px; color: #6b5b3d; font-weight: 600; padding: 12px; cursor: pointer; width: 100%; margin-top: 20px; transition: all 0.3s ease;">
                Entrenar modelo
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección de Predecir Rendimiento -->
      <div id="predecir-rendimiento-section" style="display:none;">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
          <div class="main-container" style="max-width: 1400px; width: 95%; background-color: #faf6e9; border-radius: 20px; border: 1px solid #e6e2c3; padding: 30px;">
            <!-- Encabezado -->
            <div class="text-center mb-4">
              <h1 style="font-family: 'Caveat', cursive; font-weight: 600; font-size: 2.8rem; color: #8b7e55; margin-bottom: 10px;">✨ Predicción de Rendimiento ✨</h1>
              <p style="font-family: 'Poppins', sans-serif; color: #4d6a3a; font-size: 1.1rem; margin-bottom: 25px;">
                Utilizá el modelo entrenado para predecir el rendimiento futuro de los empleados.
              </p>
            </div>
            
            <!-- Contenedor principal -->
            <div style="background-color: #fff; border-radius: 15px; border: 1px solid #e6e2c3; padding: 25px; margin-bottom: 20px;">
              <h3 style="color: #6b5b3d; font-size: 1.3rem; margin-bottom: 20px;">Cargar Datos para Predicción</h3>
              
              <div class="mb-4">
                <input type="file" id="csvFilePredecir" accept=".csv" class="hidden-file-input">
                <label for="csvFilePredecir" style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 12px 20px; color: #6b5b3d; display: block; cursor: pointer; text-align: center; width: 100%;">
                  <i class="fas fa-upload me-2"></i> Seleccionar archivo de empleados
                </label>
              </div>
              
              <p style="color: #8b7e55; font-size: 0.9rem; margin-bottom: 20px;">
                <i class="fas fa-info-circle me-2"></i> Cargá un archivo CSV con los datos de los empleados para predecir su rendimiento futuro.
              </p>
              
              <div class="mb-3">
                <label style="color: #6b5b3d; font-weight: 500; margin-bottom: 10px;">Modelo a utilizar:</label>
                <select class="form-select" style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 10px; color: #6b5b3d;">
                  <option value="ultimo">Último modelo entrenado (Precisión: 89.4%)</option>
                  <option value="modelo1">Modelo 2023-06-15 (Precisión: 87.2%)</option>
                  <option value="modelo2">Modelo 2023-03-22 (Precisión: 85.8%)</option>
                </select>
              </div>
              
              <button id="btnPredecir" style="background-color: #f0e6c7; border: none; border-radius: 10px; color: #6b5b3d; font-weight: 600; padding: 12px; cursor: pointer; width: 100%; margin-top: 20px; transition: all 0.3s ease;">
                Realizar predicción
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección de Detección de Rotación -->
      <div id="deteccion-rotacion-section" style="display:none;">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
          <div class="main-container" style="max-width: 1400px; width: 95%; background-color: #faf6e9; border-radius: 20px; border: 1px solid #e6e2c3; padding: 30px;">
            <!-- Encabezado -->
            <div class="text-center mb-4">
              <h1 style="font-family: 'Caveat', cursive; font-weight: 600; font-size: 2.8rem; color: #8b7e55; margin-bottom: 10px;">✨ Detección de Rotación ✨</h1>
              <p style="font-family: 'Poppins', sans-serif; color: #4d6a3a; font-size: 1.1rem; margin-bottom: 25px;">
                Identificá empleados con alto riesgo de rotación para tomar acciones preventivas.
              </p>
            </div>
            
            <!-- Contenedor principal -->
            <div style="background-color: #fff; border-radius: 15px; border: 1px solid #e6e2c3; padding: 25px; margin-bottom: 20px;">
              <h3 style="color: #6b5b3d; font-size: 1.3rem; margin-bottom: 20px;">Análisis de Riesgo de Rotación</h3>
              
              <div class="mb-4">
                <input type="file" id="csvFileRotacion" accept=".csv" class="hidden-file-input">
                <label for="csvFileRotacion" style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 12px 20px; color: #6b5b3d; display: block; cursor: pointer; text-align: center; width: 100%;">
                  <i class="fas fa-upload me-2"></i> Seleccionar archivo de empleados
                </label>
              </div>
              
              <p style="color: #8b7e55; font-size: 0.9rem; margin-bottom: 20px;">
                <i class="fas fa-info-circle me-2"></i> Cargá un archivo CSV con los datos de los empleados para analizar su riesgo de rotación.
              </p>
              
              <div class="mb-3">
                <label style="color: #6b5b3d; font-weight: 500; margin-bottom: 10px;">Umbral de riesgo:</label>
                <select class="form-select" style="background-color: #f8f4e5; border: 1px solid #e6e2c3; border-radius: 10px; padding: 10px; color: #6b5b3d;">
                  <option value="alto">Alto (>75%)</option>
                  <option value="medio" selected>Medio (>50%)</option>
                  <option value="bajo">Bajo (>25%)</option>
                </select>
              </div>
              
              <button id="btnDetectarRotacion" style="background-color: #f0e6c7; border: none; border-radius: 10px; color: #6b5b3d; font-weight: 600; padding: 12px; cursor: pointer; width: 100%; margin-top: 20px; transition: all 0.3s ease;">
                Analizar riesgo de rotación
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección de Perfil -->
      <div id="perfil-section" style="display:none;">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 80vh;">
          <div class="card shadow-sm p-4" style="background: #fdfbe8; border-radius: 24px; border: 2px solid #e6e2c3; max-width: 400px; width: 100%;">
            <div class="text-center mb-3">
              <h2 style="color: #4d6a3a; font-weight: 700; letter-spacing: 2px; margin-bottom: 20px;">🌿AINABI🌿</h2>
              <div style="display: flex; justify-content: center;">
                <div style="background: #e6e2c3; border-radius: 50%; width: 140px; height: 140px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; box-shadow: 0 2px 8px #b7d7c2;">
                  <img src="./assets/profilephoto.png" 
                       alt="Foto de perfil" 
                       style="width: 120px; 
                              height: 120px; 
                              border-radius: 50%; 
                              object-fit: cover;
                              transition: all 0.3s ease;
                              transform-origin: center;
                              cursor: pointer;"
                       class="profile-hover"
                       data-bs-toggle="tooltip" 
                       data-bs-placement="right" 
                       data-bs-custom-class="custom-tooltip"
                       title="¡Hola! 🌿">
                </div>
              </div>
              <h3 id="user-nombre" style="color: #4d6a3a; font-weight: 600; margin-bottom: 18px; margin-top: 10px;">Nombre Apellido</h3>
            </div>
            <div style="font-size: 1.1rem; color: #4d6a3a;">
              <div class="d-flex justify-content-between mb-2">
                <span style="font-weight: 500;">Rol:</span>
                <span id="user-rol" style="font-weight: 400;">Cargando...</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span style="font-weight: 500;">Área:</span>
                <span id="user-area" style="font-weight: 400;">Cargando...</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span style="font-weight: 500;">Jerarquía:</span>
                <span id="user-jerarquia" style="font-weight: 400;">Cargando...</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span style="font-weight: 500;">Email:</span>
                <span id="user-email" style="font-weight: 400;">Cargando...</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span style="font-weight: 500;">Activo:</span>
                <span>
                  <span id="user-activo" style="background: #e6f5d0; color: #4d6a3a; border-radius: 16px; padding: 2px 16px; font-weight: 600; font-size: 1rem;">Activo</span>
                </span>
              </div>
            </div>
            <div class="text-center mt-3">
              <button id="btn-solicitar-cambio" class="btn btn-light border btn-ainabi" style="border-radius: 12px; border: 2px solid #e6e2c3;">Solicitar cambiar datos</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
  <script src="env.js"></script>
  <script>
    // Inicializar Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.addEventListener('DOMContentLoaded', function() {
      // Función para mostrar solo la sección seleccionada
      function mostrarSeccion(seccionId) {
        // Ocultar todas las secciones
        document.getElementById('entrenamiento-ia-section').style.display = 'none';
        document.getElementById('perfil-section').style.display = 'none';
        document.getElementById('predecir-rendimiento-section').style.display = 'none';
        document.getElementById('deteccion-rotacion-section').style.display = 'none';
        
        // Mostrar la sección seleccionada
        document.getElementById(seccionId).style.display = 'block';
      }

      // Cambia la clase activa en la barra lateral
      function setActiveNav(navId) {
        document.getElementById('nav-entrenamiento-ia').classList.remove('nav-activa');
        document.getElementById('nav-predecir-rendimiento').classList.remove('nav-activa');
        document.getElementById('nav-deteccion-rotacion').classList.remove('nav-activa');
        document.getElementById('nav-perfil').classList.remove('nav-activa');
        document.getElementById(navId).classList.add('nav-activa');
      }

      // Por defecto, mostrar la sección de entrenamiento IA
      mostrarSeccion('entrenamiento-ia-section');
      setActiveNav('nav-entrenamiento-ia');

      // Navegación entre secciones
      document.getElementById('nav-entrenamiento-ia').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('entrenamiento-ia-section');
        setActiveNav('nav-entrenamiento-ia');
      });

      document.getElementById('nav-predecir-rendimiento').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('predecir-rendimiento-section');
        setActiveNav('nav-predecir-rendimiento');
      });

      document.getElementById('nav-deteccion-rotacion').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('deteccion-rotacion-section');
        setActiveNav('nav-deteccion-rotacion');
      });

      document.getElementById('nav-perfil').addEventListener('click', function(e) {
        e.preventDefault();
        mostrarSeccion('perfil-section');
        setActiveNav('nav-perfil');
      });

      // Logout
      document.getElementById('btn-logout').addEventListener('click', async function(e) {
        e.preventDefault();
        try {
          await firebase.auth().signOut();
          window.location.href = './login.html';
        } catch (error) {
          console.error('Error al cerrar sesión:', error);
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'No se pudo cerrar la sesión',
            confirmButtonColor: '#4d6a3a'
          });
        }
      });

      // Manejo de carga de archivo CSV
      const csvFileInput = document.getElementById('csvFile');
      
      csvFileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          // En un caso real, aquí procesaríamos el CSV
          Swal.fire({
            title: 'Archivo cargado',
            text: 'El archivo CSV ha sido cargado correctamente',
            icon: 'success',
            confirmButtonColor: '#4d6a3a'
          });
        }
      });
      
      // Manejo de carga de archivo CSV para predicción
      const csvFilePredecirInput = document.getElementById('csvFilePredecir');
      
      if (csvFilePredecirInput) {
        csvFilePredecirInput.addEventListener('change', function(e) {
          if (e.target.files.length > 0) {
            Swal.fire({
              title: 'Archivo cargado',
              text: 'El archivo CSV para predicción ha sido cargado correctamente',
              icon: 'success',
              confirmButtonColor: '#4d6a3a'
            });
          }
        });
      }
      
      // Manejo de carga de archivo CSV para detección de rotación
      const csvFileRotacionInput = document.getElementById('csvFileRotacion');
      
      if (csvFileRotacionInput) {
        csvFileRotacionInput.addEventListener('change', function(e) {
          if (e.target.files.length > 0) {
            Swal.fire({
              title: 'Archivo cargado',
              text: 'El archivo CSV para análisis de rotación ha sido cargado correctamente',
              icon: 'success',
              confirmButtonColor: '#4d6a3a'
            });
          }
        });
      }
      
      // Botón de entrenar modelo
      const btnTrainModel = document.getElementById('btnTrainModel');
      
      btnTrainModel.addEventListener('click', function() {
              Swal.fire({
          title: 'Entrenando modelo',
          text: 'El proceso puede tomar unos minutos...',
          icon: 'info',
                confirmButtonColor: '#4d6a3a',
          showConfirmButton: false,
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
            
            // Simulamos el entrenamiento
            setTimeout(() => {
              Swal.fire({
                title: '¡Entrenamiento completado!',
                text: 'El modelo ha sido entrenado con éxito. Precisión: 89.4%',
                icon: 'success',
                confirmButtonColor: '#4d6a3a'
              });
            }, 3000);
              }
            });
        });

      // Botón para realizar predicción
      const btnPredecir = document.getElementById('btnPredecir');
      
      if (btnPredecir) {
        btnPredecir.addEventListener('click', function() {
          const fileInput = document.getElementById('csvFilePredecir');
          if (!fileInput.files.length) {
            Swal.fire({
              title: 'Error',
              text: 'Por favor, seleccioná un archivo CSV para realizar la predicción',
              icon: 'error',
              confirmButtonColor: '#4d6a3a'
            });
            return;
          }
          
          Swal.fire({
            title: 'Realizando predicción',
            text: 'Analizando datos y generando predicciones...',
            icon: 'info',
            confirmButtonColor: '#4d6a3a',
            showConfirmButton: false,
            allowOutsideClick: false,
            didOpen: () => {
              Swal.showLoading();
              
              // Simulamos el proceso de predicción
              setTimeout(() => {
                Swal.fire({
                  title: '¡Predicción completada!',
                  text: 'Los resultados han sido generados correctamente',
                  icon: 'success',
                  confirmButtonColor: '#4d6a3a'
                });
              }, 2500);
            }
          });
        });
      }
      
      // Botón para analizar riesgo de rotación
      const btnDetectarRotacion = document.getElementById('btnDetectarRotacion');
      
      if (btnDetectarRotacion) {
        btnDetectarRotacion.addEventListener('click', function() {
          const fileInput = document.getElementById('csvFileRotacion');
          if (!fileInput.files.length) {
            Swal.fire({
              title: 'Error',
              text: 'Por favor, seleccioná un archivo CSV para analizar el riesgo de rotación',
              icon: 'error',
              confirmButtonColor: '#4d6a3a'
            });
            return;
          }
          
          Swal.fire({
            title: 'Analizando riesgo de rotación',
            text: 'Procesando datos y calculando probabilidades...',
            icon: 'info',
            confirmButtonColor: '#4d6a3a',
            showConfirmButton: false,
            allowOutsideClick: false,
            didOpen: () => {
              Swal.showLoading();
              
              // Simulamos el proceso de análisis
              setTimeout(() => {
                Swal.fire({
                  title: '¡Análisis completado!',
                  text: 'Se han identificado 5 empleados con alto riesgo de rotación',
                  icon: 'success',
                  confirmButtonColor: '#4d6a3a'
                });
              }, 2500);
            }
          });
        });
      }

      // Botón para solicitar cambio de datos
      const btnSolicitarCambio = document.getElementById('btn-solicitar-cambio');
      if (btnSolicitarCambio) {
        btnSolicitarCambio.addEventListener('click', function() {
          Swal.fire({
            title: 'Solicitud de cambio de datos',
            html: `
              <form id="form-cambio-datos" style="text-align: left;">
                <div class="mb-3">
                  <label class="form-label" style="color: #4d6a3a;">¿Qué datos necesitas modificar?</label>
                  <textarea class="form-control" id="datos-a-modificar" rows="3" placeholder="Describe los datos que necesitas cambiar..."></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label" style="color: #4d6a3a;">Motivo de la solicitud</label>
                  <input type="text" class="form-control" id="motivo-solicitud" placeholder="Indica el motivo...">
                </div>
              </form>
            `,
            showCancelButton: true,
            confirmButtonText: 'Enviar solicitud',
            cancelButtonText: 'Cancelar',
            confirmButtonColor: '#4d6a3a',
            cancelButtonColor: '#d33',
            customClass: {
              popup: 'custom-popup-class',
              title: 'custom-title-class',
              confirmButton: 'custom-confirm-button'
            }
          }).then((result) => {
            if (result.isConfirmed) {
              Swal.fire({
                title: '¡Solicitud enviada!',
                text: 'Tu solicitud ha sido enviada con éxito. Te contactaremos pronto.',
                icon: 'success',
                confirmButtonColor: '#4d6a3a',
                customClass: {
                  popup: 'custom-popup-class',
                  title: 'custom-title-class',
                  confirmButton: 'custom-confirm-button'
                }
              });
            }
          });
        });
      }

      // Cargar datos del usuario logueado
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          try {
            const doc = await db.collection("users").doc(user.uid).get();
            if (doc.exists) {
              const data = doc.data();
              
              // Actualizar campos del perfil
              document.getElementById('user-nombre').textContent = data.nombre || "Sin nombre";
              document.getElementById('user-rol').textContent = data.role || "Sin rol";
              document.getElementById('user-area').textContent = data.area || "Sin área";
              document.getElementById('user-jerarquia').textContent = data.jerarquia || "Sin jerarquía";
              document.getElementById('user-email').textContent = data.email || user.email || "Sin email";
              
              // Estado activo
              if (typeof data.activo !== "undefined") {
                document.getElementById('user-activo').textContent = data.activo ? "Activo" : "Inactivo";
                document.getElementById('user-activo').style.background = data.activo ? "#e6f5d0" : "#f5e6e6";
                document.getElementById('user-activo').style.color = data.activo ? "#4d6a3a" : "#a94442";
              } else {
                document.getElementById('user-activo').textContent = "Sin dato";
                document.getElementById('user-activo').style.background = "#f5e6e6";
                document.getElementById('user-activo').style.color = "#a94442";
              }
            }
          } catch (error) {
            console.error('Error al obtener datos del usuario:', error);
            Swal.fire({
              title: 'Error',
              text: 'No se pudieron cargar los datos del usuario',
              icon: 'error',
              confirmButtonColor: '#4d6a3a'
            });
          }
        } else {
          console.log('No hay usuario autenticado');
          // No redirigir si ya estamos en la página de login
          if (!window.location.pathname.includes('login.html')) {
            window.location.href = './login.html';
          }
        }
      });

      // Inicializar tooltips de Bootstrap
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });
  </script>
</body>
</html>